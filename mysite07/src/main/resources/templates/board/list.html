<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<title>mysite</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link th:href="@{/assets/css/board.css}" rel="stylesheet"
	type="text/css">
</head>
<body>
	<div id="container">
        <th:block th:include="includes/header"></th:block>
		<div id="content">
			<div id="board">
				<form id="search_form" action="${pageContext.request.contextPath}/board" method="get">
					<input type="text" id="kwd" name="kwd" value="${result.keyword}">
					<input type="submit" value="찾기">
				</form>
				<table class="tbl-ex">
					<tr>
						<th>번호</th>
						<th>제목</th>
						<th>글쓴이</th>
						<th>조회수</th>
						<th>작성일</th>
						<th>&nbsp;</th>
					</tr>
					
						<tr th:each="vo, status: ${result.list}">
							<td>${result.cntPages - (result.currentPage - 1) * 5 - status.index}</td>
							<td >
								<th:block if="${vo.depth > 0}">
									<img th:src="@{/assets/images/reply.png}">
								</c:if>
									<a th:href="${/board/view?boardId=${vo.id}}">${vo.title}</a>
							</td>
							<td>${vo.userName}</td>
							<td>${vo.hit}</td>
							<td>${vo.regDate}</td>
							<td>
								<sec:authorize access="isAuthenticated()">
									<sec:authentication property="principal" var="authUser"/>
									<c:choose>
										<c:when test="${not empty authUser && authUser.id == vo.userId }">
											<a href="${pageContext.request.contextPath}/board/delete?boardId=${vo.id}" class="del" style="background-image:url(${pageContext.request.contextPath }/assets/images/recycle.png)">삭제</a>
										</c:when>
										<c:otherwise>
											&nbsp;
										</c:otherwise>
									</c:choose>									
								</sec:authorize>
							</td>
						</tr>
				</table>
				
				<div class="pager">
					<c:if test="${not empty result.keyword}">
						<c:set var="pageKeyword" value = "&kwd=${result.keyword}"></c:set>
					</c:if>
					<ul>
						<li>
							<c:choose>
								<c:when test="${result.beginPage > 1}">
									<a href="${pageContext.request.contextPath}/board?page=${result.beginPage-1}${pageKeyword}">◀</a>
								</c:when>
								<c:otherwise>◀</c:otherwise>
							</c:choose>
						</li>
						<c:forEach var='i' begin="${result.beginPage}" end ="${result.endPage}">
							<c:choose>
								<c:when test="${i == result.currentPage}">
									<li class="selected">${i}</li>
								</c:when>
								<c:when test="${(i >= result.startPage) and (i <= result.totalPage)}">
									<li><a href="${pageContext.request.contextPath}/board?page=${i}${pageKeyword}">${i}</a></li>
								</c:when>
								<c:otherwise>
									<li>${i}</li>
								</c:otherwise>
							</c:choose>
						</c:forEach>
						<li>
							<c:choose>
								<c:when test="${result.endPage < result.totalPage}">
									<a href="${pageContext.request.contextPath}/board?page=${result.endPage+1}${pageKeyword}">▶</a>
								</c:when>
								<c:otherwise>▶</c:otherwise>
							</c:choose>
						</li>	
					</ul>
				</div>					
				
				<sec:authorize access="isAuthenticated()">
					<div class="bottom">
						<a href="${pageContext.request.contextPath}/board/write?type=origin" id="new-book">글쓰기</a>
					</div>
				</sec:authorize>	
			</div>
		</div>
		<th:block th:include="includes/navigation"></th:block>
		<th:block th:include="includes/footer"></th:block>
	</div>
</body>
</html>